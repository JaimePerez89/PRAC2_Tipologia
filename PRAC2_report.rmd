---
title: "PRAC2 Tipología y ciclo de vida"
author: "Ana Hubel & Jaime Pérez"
date: '`r format(Sys.Date(),"%e de %B, %Y")`'
output:
  html_document:
    toc: yes
    toc_float: true
    number_sections: true
editor_options: 
  chunk_output_type: console
---


```{r load_libraries, include=FALSE}
# CARGA DE LIBRERIAS
# Librerias a cargar durante la generación del presente informe
PACKAGES <- c("dplyr", "ggplot2", "tidyverse", "reshape", "gridExtra", "psych")
# Install packages
inst <- match(PACKAGES, .packages(all=TRUE))
need <- which(is.na(inst))
if (length(need) > 0) install.packages(PACKAGES[need], repos = "http://cran.us.r-project.org")
# Load packages
lapply(PACKAGES, require, character.only=T)
```



# Detalles de la actividad

En esta práctica se elabora un caso práctico orientado a aprender a identificar los datos relevantes para un proyecto analítico y usar las herramientas de integración, limpieza, validación y análisis de las mismas.

Los objetivos concretos de esta práctica son: 

- Aprender a aplicar los conocimientos adquiridos y su capacidad de resolución de problemas en entornos nuevos o poco conocidos dentro de contextos más amplios o multidisciplinares. 
- Saber identificar los datos relevantes y los tratamientos necesarios (integración, limpieza y validación) para llevar a cabo un proyecto analítico. 
- Aprender a analizar los datos adecuadamente para abordar la información contenida en los datos. 
- Identificar la mejor representación de los resultados para aportar conclusiones sobre el problema planteado en el proceso analítico. 
- Actuar con los principios éticos y legales relacionados con la manipulación de datos en función del ámbito de aplicación. 
- Desarrollar las habilidades de aprendizaje que les permitan continuar estudiando de un modo que tendrá que ser en gran medida autodirigido o autónomo. 
- Desarrollar la capacidad de búsqueda, gestión y uso de información y recursos en el ámbito de la ciencia de datos.

Contribuciones durante la presente práctica:

 **Contribuciones**    |  **Firma** | 
-----------------------| ----------------------|
*Investigación previa* | Jaime Pérez & Ana Hubel 
*Redacción de las respuestas* | Jaime Pérez & Ana Hubel
*Desarrollo código* | Jaime Pérez & Ana Hubel


# Descripción del dataset y objetivos del análisis

## Descripción dataset

La base de datos elegida contiene un total de 32 atributos de 569 muestras de tejidos afectados por cancer de mama. Los atributos contienen información de las medias, desviaciones y de las medidas más desfavorables de una serie de características de las células cancerígenas.

Links descarga datasets:

> https://www.kaggle.com/uciml/breast-cancer-wisconsin-data?select=data.csv
> https://archive.ics.uci.edu/ml/datasets/Breast+Cancer+Wisconsin+%28Diagnostic%29

Las características de la base de datos se han calculado a partir de imágenes digitalizadas de muestras de tumores de mama. Describen las características de los núcleos celulares presentes en la imagen.

El procedimiento de toma de datos, de acuerdo a "W.N. Street, W.H. Wolberg and O.L. Mangasarian. Nuclear feature extraction for breast tumor diagnosis.", empieza por obtener a pequeña cantidad de fluido (masa) del tumor de mama utilizando una aguja fina (FNA). Para sacar las imágenes se expande ese material en un cristal y se toman imágenes utilizando una cámara JVC TK-1070U montada sobre un microscopio Olympus. Mediante el análisis de las imágenes se han obtenido diez características diferentes basadas en los límites de los núcleos celulares. Todas ellas son numéricamente modeladas de forma que a mayor valor, mayor probabilidad de ser maligno. Las características extraidas son:

- Radius: el radio de un núcleo individual se mide promediando la longitud de los segmentos de la línea radial definidos por el centroide de los "snakes" y los puntos individuales de los "snakes". [Nota: los Snakes son una serie de unidades basadas en contornos generadas durante el análisis de las imágenes]

<center>

![Snakes generados durante el análisis de las imágenes](./img/Snakes.png){width='400px'}

</center>

- Perimeter: distancia total entre los puntos de los snakes que constituyen el núcleo del perímetro.
- Area: el área se es medido mediante el conteo del número de pixels en el interior del snake, añadiendo la mitad de los pixel del perímetro.
- Compactness: combinación del perímetro y del área para dar una medida de compactación utilizando la fórmula $perimeter^2/area$.
- Smoothness: la suavidad de un contorno nuclear se cuantifica midiendo la diferencia entre la longitud de la línea radial y la longitud media de las líneas que la rodean.

<center>

![Lineas radiales utilizadas para el cáclulo de la suavidad](./img/smooth.png){width='200px'}

</center>

- Concavity: severidad de las cavidades o prominencias de las células de los núcleos.

<center>

![Concavity](./img/concav.png){width='200px'}

</center>

- Concave Points: atributo similar al anterior pero que únicamente mide el número de prominencias en lugar de la magnitud de las mismas.
- Symmetry: simetría calculada en base a las diferencias entre las longitudes de las líneas ficticias perpendiculares al eje principales de la célula (el mayor)

<center>

![Líneas utilizadas para el cálculo de la simetría](./img/symmetry.png){width='200px'}

</center>

- Fractal Dimension: la dimension fractal de una célula es aproximada mediante la "coastline approximation" descrita por Mandelbrot

<center>

![Secuencia de medidas durante la computación de la dimensión fractal](./img/fractal.png){width='400px'}

</center>

- Texture: la textura de la célula es medida mediante la búsqueda de la varianza de las intensidades de la escala de grises de los píxeles que componen las imágenes.

- diagnosis: este atributo no ha sido obtenido del análisis de las imágenes. Identifica los tumores como malignos ("M") o benignos ("B"). Será el atríbuto clave de cara a entregar y a probar los algoritmos generados.


## Objetivos

El objetivo principal del análisis será la identificación de las variables que mejor determinen si las muestras de masas cancerígenas de mama se califican como malignas o benignas. Además, se procederá a la creación de modelos que permitan predecirlas en base a sus características y contrastes de hipótesis que permitan inferir propiedades interesantes en las muestras en futuras investigaciones.

Al tratarse de información muy crítica por referirse a la salud de personas, se realizará un estudio de los parámetros de los modelos que penalicen la identificación de tumores malignos como benignos, lo cual podría ser muy grave para la salud de los pacientes.




# Integración y selección de los datos de interés

## Lectura fichero y elementos vacios

En primer lugar, procedemos a lectura del fichero mediante la función read.csv.

```{r}
data_breast_cancer <- read.csv("./Data/breast_cancer.csv")
head(data_breast_cancer, 3)
```

En principio, según la información original de la base de datos, no se dispone de valores faltantes (NAs) en ninguno de sus atributos. Sin embargo, durante la lectura del archivo se observa que la función de lectura reconoce un atributo adicional "X" el cual si que contiene valores no disponibles. De cara a asegurarnos que no se han producido problemas adicionales, vamos a analizar el número total de NA para cada uno de los atributos.

```{r}
colSums(is.na(data_breast_cancer))
```

Comprobamos como la única variable que contiene valores perdidos es el atributo "X", el cual procedemos a eliminar de nuestra base de datos ya que se debe a un error en la lectura del archivo.

```{r}
data_breast_cancer <- data_breast_cancer %>% select(-X)
```

## Selección de datos de interés

La gran mayoría de las variables presentes en el conjunto de datos contiene información que no será relevante durante la creación de nuestros modelos. En concreto, para cada uno de los atributos descritos en el apartado anterior y debido a que son valores numéricos resultantes de un análisis de imagen previo, se proporcionan valores de media (XX_mean), desviación (XX_se) y el valor más desfavorable (XX_worst) durante su cálculo.

En nuestro caso, la variable que mejor nos identificará los núcleos tumorales será aquella que indica la media, por lo que procedemos a eliminar de nuestra base de datos el resto de variables:

```{r}
data <- data_breast_cancer %>% select(id, diagnosis, radius_mean, texture_mean, perimeter_mean, area_mean, smoothness_mean, compactness_mean, concavity_mean, concave.points_mean, symmetry_mean, fractal_dimension_mean)
```

Adicionalmente, podemos formatear los nombres de las variables para eliminar el apellido mean:

```{r}
names(data) <- c("id", "diagnosis", "radius", "texture", "perimeter", "area", "smoothness", "compactness", "concavity", "concave_points", "symmetry", "fractal_dimension")
head(data)
```



# Limpieza de datos

Como ya hemos analizado previamente, la base de datos no contiene "missing values". No obstante, antes de confirmar que se encuentra limpia, será necesario analizar aquellos datos que puedan no ser congruentes en comparación con el resto. Éstos son los denominados valores extremos o "outliers".

Para identificarlos el método más común es la utilización de los diagramas de cajas que analizan el rango intercuartílico de cada una de las variables de forma individual.

A continuación, vamos a representar de forma gráfica los boxplots de cada una de las variables identificando en color rojo aquellos valores susceptibles de ser considerados valores anómalos.

```{r}
plot1 <- data %>%
  ggplot(aes(y=radius)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

plot2 <- data %>%
  ggplot(aes(y=texture)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

plot3 <- data %>%
  ggplot(aes(y=perimeter)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

plot4 <- data %>%
  ggplot(aes(y=area)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

plot5 <- data %>%
  ggplot(aes(y=smoothness)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

grid.arrange(plot1, plot2, plot3, plot4, plot5)
```


```{r}
plot1 <- data %>%
  ggplot(aes(y=compactness)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

plot2 <- data %>%
  ggplot(aes(y=concavity)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

plot3 <- data %>%
  ggplot(aes(y=concave_points)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

plot4 <- data %>%
  ggplot(aes(y=symmetry)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

plot5 <- data %>%
  ggplot(aes(y=fractal_dimension)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=8) + theme_bw()

grid.arrange(plot1, plot2, plot3, plot4, plot5)
```


Comprobamos como para todas las variables se muestran valores remarcados en rojo, los cuales el boxplot identifica como outliers por encontrarse a una distancia mayor de 1,5 veces mayores que el rango intercuartílico de los correspondientes percentiles 0.25 y 0.75. De forma numérica, los valores detectados para cada una de las variables son:


```{r}
for(i in 3:12){
  calc <- boxplot.stats(data[,i])$out
  print(sprintf("Para la variable % s los outliers identificados son:", names(data)[i]))
  print(sprintf("% s", calc))
}
```

En base a la información gráfica y numérica de los valores extremos anteriores, aunque se detecten como valores outliers, no vamos a eliminarlos del análisis por considerarlos consistentes con el conjunto de los datos.



# Análisis de los datos


Estudio normalidad

```{r}
data %>% select(-id, -diagnosis) %>% multi.hist(dcol = c("blue", "red"), dlty = c("dotted", "solid"), main = "")
```



# Representación de los resultados





# Conclusiones





